<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Inspección Vehicular</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            padding: 20px;
        }

        .container {
            max-width: 850px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            border-bottom: 3px solid #333;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .header h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 5px;
        }

        .section {
            margin-bottom: 25px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }

        .section-title {
            background-color: #333;
            color: white;
            padding: 8px 12px;
            margin: -15px -15px 15px -15px;
            border-radius: 5px 5px 0 0;
            font-size: 16px;
            font-weight: bold;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 13px;
            color: #333;
        }

        .form-group label.required::after {
            content: " *";
            color: red;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .file-upload {
            margin-bottom: 15px;
        }

        .file-upload input {
            padding: 8px;
        }

        .vehicle-image {
            text-align: center;
            margin: 15px 0;
        }

        .vehicle-image img {
            max-width: 300px;
            height: auto;
            border: 2px solid #ddd;
            border-radius: 5px;
        }

        .checklist {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            padding: 5px;
        }

        .checklist-item input[type="checkbox"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
        }

        .checklist-item label {
            font-size: 13px;
        }

        .tire-pressure {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .tire-input {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            background: #f9f9f9;
            border-radius: 4px;
        }

        .tire-input label {
            font-weight: bold;
            font-size: 13px;
        }

        .tire-input input {
            width: 80px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .signature-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .signature-box {
            border: 2px dashed #ccc;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
        }

        .signature-box canvas {
            border: 1px solid #ddd;
            cursor: crosshair;
            width: 100%;
            height: 120px;
            background: white;
        }

        .signature-box button {
            margin-top: 10px;
            padding: 5px 15px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .signature-box button:hover {
            background: #d32f2f;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background-color: #45a049;
        }

        .btn-secondary {
            background-color: #2196F3;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #0b7dda;
        }

        .hidden {
            display: none !important;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: normal;
        }

        .info-display {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .info-display p {
            margin: 5px 0;
            font-size: 14px;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                max-width: 100%;
            }

            .btn, .file-upload, .signature-box button {
                display: none;
            }

            @page {
                size: legal;
                margin: 1cm;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="printable-area">
        <div class="header">
            <h1>REGISTRO DE INSPECCIÓN VEHICULAR</h1>
            <p>Sistema de Control y Seguimiento</p>
        </div>

        <!-- Carga de Base de Datos CSV -->
        <div class="section">
            <div class="section-title">Cargar Base de Datos</div>
            <div class="file-upload">
                <label for="csvFile" class="required">Archivo CSV de Base de Datos:</label>
                <input type="file" id="csvFile" accept=".csv" required>
            </div>
        </div>

        <!-- Búsqueda de Placa -->
        <div class="section">
            <div class="section-title">Búsqueda de Vehículo</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="placa" class="required">Número de Placa:</label>
                    <input type="text" id="placa" placeholder="Ej: ABC123" required>
                </div>
                <div class="form-group">
                    <button class="btn btn-secondary" onclick="buscarVehiculo()" style="margin-top: 22px;">Buscar Vehículo</button>
                </div>
            </div>
            <div id="vehicleInfo" class="info-display hidden"></div>
        </div>

        <!-- Datos del Vehículo -->
        <div class="section">
            <div class="section-title">Información del Vehículo</div>
            
            <div class="vehicle-image" id="vehicleImageContainer" class="hidden">
                <img id="vehicleImage" src="" alt="Imagen del vehículo">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="tipoVehiculo" class="required">Tipo de Vehículo:</label>
                    <select id="tipoVehiculo" required onchange="actualizarFormulario()">
                        <option value="">Seleccione...</option>
                        <option value="automovil">Automóvil</option>
                        <option value="moto">Motocicleta</option>
                        <option value="camion">Camión</option>
                        <option value="bus">Bus</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="clase">Clase:</label>
                    <input type="text" id="clase" readonly>
                </div>
                <div class="form-group">
                    <label for="carroceria">Carrocería:</label>
                    <input type="text" id="carroceria" readonly>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="marca">Marca:</label>
                    <input type="text" id="marca" readonly>
                </div>
                <div class="form-group">
                    <label for="modelo">Modelo:</label>
                    <input type="text" id="modelo" readonly>
                </div>
                <div class="form-group">
                    <label for="color">Color:</label>
                    <input type="text" id="color" readonly>
                </div>
            </div>
        </div>

        <!-- Datos del Cliente -->
        <div class="section">
            <div class="section-title">Información del Propietario</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="nombreCliente" class="required">Nombre Completo:</label>
                    <input type="text" id="nombreCliente" readonly required>
                </div>
                <div class="form-group">
                    <label for="cedulaCliente" class="required">Cédula:</label>
                    <input type="text" id="cedulaCliente" readonly required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="telefono">Teléfono:</label>
                    <input type="tel" id="telefono" readonly>
                </div>
                <div class="form-group">
                    <label for="email">Correo Electrónico:</label>
                    <input type="email" id="email" readonly>
                </div>
            </div>
        </div>

        <!-- Tipo de Inspección -->
        <div class="section">
            <div class="section-title">Tipo de Inspección</div>
            <div class="form-group">
                <label class="required">Frecuencia:</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="frecuencia" value="primera" onchange="actualizarFormulario()" required>
                        Primera Vez
                    </label>
                    <label>
                        <input type="radio" name="frecuencia" value="segunda" onchange="actualizarFormulario()">
                        Segunda Vez
                    </label>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="fechaInspeccion" class="required">Fecha de Inspección:</label>
                    <input type="date" id="fechaInspeccion" required>
                </div>
                <div class="form-group">
                    <label for="inspector" class="required">Inspector:</label>
                    <input type="text" id="inspector" required>
                </div>
            </div>
        </div>

        <!-- Checklist de Preparación -->
        <div class="section">
            <div class="section-title">Checklist de Preparación de la Muestra</div>
            <div class="checklist" id="checklistContainer"></div>
        </div>

        <!-- Presión de Neumáticos -->
        <div class="section" id="tireSection">
            <div class="section-title">Registro de Presión de Neumáticos (PSI)</div>
            <div class="tire-pressure" id="tirePressureContainer"></div>
        </div>

        <!-- Pruebas a Realizar (solo segunda vez) -->
        <div class="section hidden" id="pruebasSection">
            <div class="section-title">Pruebas a Realizar</div>
            <div class="checklist">
                <div class="checklist-item">
                    <input type="checkbox" id="pruebaFreno" name="pruebas">
                    <label for="pruebaFreno">Sistema de Frenos</label>
                </div>
                <div class="checklist-item">
                    <input type="checkbox" id="pruebaSuspension" name="pruebas">
                    <label for="pruebaSuspension">Suspensión</label>
                </div>
                <div class="checklist-item">
                    <input type="checkbox" id="pruebaLuces" name="pruebas">
                    <label for="pruebaLuces">Sistema de Luces</label>
                </div>
                <div class="checklist-item">
                    <input type="checkbox" id="pruebaEmisiones" name="pruebas">
                    <label for="pruebaEmisiones">Emisiones de Gases</label>
                </div>
                <div class="checklist-item">
                    <input type="checkbox" id="pruebaDireccion" name="pruebas">
                    <label for="pruebaDireccion">Sistema de Dirección</label>
                </div>
                <div class="checklist-item">
                    <input type="checkbox" id="pruebaEscape" name="pruebas">
                    <label for="pruebaEscape">Sistema de Escape</label>
                </div>
            </div>
            <div class="form-group" style="margin-top: 15px;">
                <label for="observacionesPruebas">Observaciones de Pruebas:</label>
                <textarea id="observacionesPruebas" rows="4"></textarea>
            </div>
        </div>

        <!-- Observaciones Generales -->
        <div class="section">
            <div class="section-title">Observaciones Generales</div>
            <div class="form-group">
                <label for="observaciones">Observaciones Adicionales:</label>
                <textarea id="observaciones" rows="4" placeholder="Ingrese cualquier observación relevante..."></textarea>
            </div>
        </div>

        <!-- Estado del Vehículo -->
        <div class="section">
            <div class="section-title">Estado Final</div>
            <div class="form-group">
                <label class="required">Resultado de la Inspección:</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="resultado" value="aprobado" required>
                        Aprobado
                    </label>
                    <label>
                        <input type="radio" name="resultado" value="rechazado">
                        Rechazado
                    </label>
                    <label>
                        <input type="radio" name="resultado" value="condicional">
                        Aprobado con Observaciones
                    </label>
                </div>
            </div>
        </div>

        <!-- Firmas -->
        <div class="section">
            <div class="section-title">Firmas</div>
            <div class="signature-section">
                <div class="signature-box">
                    <label><strong>Firma del Inspector</strong></label>
                    <canvas id="firmaInspector"></canvas>
                    <button onclick="limpiarFirma('firmaInspector')">Limpiar</button>
                </div>
                <div class="signature-box">
                    <label><strong>Firma del Propietario</strong></label>
                    <canvas id="firmaPropietario"></canvas>
                    <button onclick="limpiarFirma('firmaPropietario')">Limpiar</button>
                </div>
            </div>
        </div>

        <!-- Botones de Acción -->
        <div class="button-group">
            <button class="btn btn-primary" onclick="guardarRegistro()">Guardar Registro</button>
            <button class="btn btn-secondary" onclick="exportarPDF()">Exportar a PDF (Oficio)</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script>
        let vehiculosDB = [];
        let currentVehicle = null;

        // Configuración de Canvas para firmas
        function setupCanvas(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            let drawing = false;

            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;

            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Soporte táctil
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);

            function startDrawing(e) {
                drawing = true;
                ctx.beginPath();
                const rect = canvas.getBoundingClientRect();
                ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
            }

            function draw(e) {
                if (!drawing) return;
                const rect = canvas.getBoundingClientRect();
                ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            function stopDrawing() {
                drawing = false;
            }

            function handleTouch(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 'mousemove', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }
        }

        function limpiarFirma(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Inicializar canvas de firmas
        document.addEventListener('DOMContentLoaded', function() {
            setupCanvas('firmaInspector');
            setupCanvas('firmaPropietario');
            document.getElementById('fechaInspeccion').valueAsDate = new Date();
        });

        // Leer archivo CSV
        document.getElementById('csvFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    parseCSV(event.target.result);
                };
                reader.readAsText(file);
            }
        });

        function parseCSV(csv) {
            const lines = csv.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            
            vehiculosDB = [];
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                
                const values = lines[i].split(',').map(v => v.trim());
                const vehicle = {};
                
                headers.forEach((header, index) => {
                    vehicle[header] = values[index] || '';
                });
                
                vehiculosDB.push(vehicle);
            }
            
            alert('Base de datos cargada exitosamente. Total de vehículos: ' + vehiculosDB.length);
        }

        function buscarVehiculo() {
            const placa = document.getElementById('placa').value.toUpperCase();
            
            if (!vehiculosDB.length) {
                alert('Por favor, cargue primero el archivo CSV de la base de datos.');
                return;
            }

            const vehiculo = vehiculosDB.find(v => v.placa && v.placa.toUpperCase() === placa);
            
            if (vehiculo) {
                currentVehicle = vehiculo;
                mostrarDatosVehiculo(vehiculo);
            } else {
                alert('Vehículo no encontrado en la base de datos.');
                limpiarFormulario();
            }
        }

        function mostrarDatosVehiculo(vehiculo) {
            // Mostrar información
            const infoDiv = document.getElementById('vehicleInfo');
            infoDiv.innerHTML = `
                <p><strong>Vehículo Encontrado:</strong> ${vehiculo.marca} ${vehiculo.modelo}</p>
                <p><strong>Propietario:</strong> ${vehiculo.nombreCliente} - CC: ${vehiculo.cedulaCliente}</p>
            `;
            infoDiv.classList.remove('hidden');

            // Llenar campos
            document.getElementById('tipoVehiculo').value = vehiculo.tipoVehiculo || '';
            document.getElementById('clase').value = vehiculo.clase || '';
            document.getElementById('carroceria').value = vehiculo.carroceria || '';
            document.getElementById('marca').value = vehiculo.marca || '';
            document.getElementById('modelo').value = vehiculo.modelo || '';
            document.getElementById('color').value = vehiculo.color || '';
            document.getElementById('nombreCliente').value = vehiculo.nombreCliente || '';
            document.getElementById('cedulaCliente').value = vehiculo.cedulaCliente || '';
            document.getElementById('telefono').value = vehiculo.telefono || '';
            document.getElementById('email').value = vehiculo.email || '';

            // Mostrar imagen si existe
            if (vehiculo.imagenURL) {
                document.getElementById('vehicleImage').src = vehiculo.imagenURL;
                document.getElementById('vehicleImageContainer').classList.remove('hidden');
            }

            actualizarFormulario();
        }

        function limpiarFormulario() {
            document.getElementById('vehicleInfo').classList.add('hidden');
            document.getElementById('vehicleImageContainer').classList.add('hidden');
            document.getElementById('tipoVehiculo').value = '';
            document.getElementById('clase').value = '';
            document.getElementById('carroceria').value = '';
            document.getElementById('marca').value = '';
            document.getElementById('modelo').value = '';
            document.getElementById('color').value = '';
            document.getElementById('nombreCliente').value = '';
            document.getElementById('cedulaCliente').value = '';
            document.getElementById('telefono').value = '';
            document.getElementById('email').value = '';
        }

        function actualizarFormulario() {
            const tipoVehiculo = document.getElementById('tipoVehiculo').value;
            const frecuencia = document.querySelector('input[name="frecuencia"]:checked')?.value;

            // Actualizar checklist según tipo de vehículo
            actualizarChecklist(tipoVehiculo);

            // Actualizar presión de neumáticos
            actualizarPresionNeumaticos(tipoVehiculo);

            // Mostrar/ocultar sección de pruebas según frecuencia
            const pruebasSection = document.getElementById('pruebasSection');
            if (frecuencia === 'segunda') {
                pruebasSection.classList.remove('hidden');
            } else {
                pruebasSection.classList.add('hidden');
            }
        }

        function actualizarChecklist(tipo) {
            const container = document.getElementById('checklistContainer');
            let items = [];

            if (tipo === 'moto') {
                items = [
                    'Casco en buen estado',
                    'Espejos retrovisores',
                    'Luces funcionando',
                    'Sistema de frenos',
                    'Neumáticos en buen estado',
                    'Cadena de transmisión',
                    'Bocina operativa',
                    'Documentación al día'
                ];
            } else {
                items = [
                    'Luces delanteras y traseras',
                    'Cinturones de seguridad',
                    'Espejos retrovisores',
                    'Parabrisas sin daños',
                    'Limpiaparabrisas operativos',
                    'Bocina funcionando',
                    'Sistema de frenos',
                    'Neumáticos en buen estado',
                    'Triángulo de seguridad',
                    'Extintor vigente',
                    'Botiquín de primeros auxilios',
                    'Documentación al día'
                ];
            }

            container.innerHTML = items.map((item, index) => `
                <div class="checklist-item">
                    <input type="checkbox" id="check${index}" name="checklist">
                    <label for="check${index}">${item}</label>
                </div>
            `).join('');
        }

        function actualizarPresionNeumaticos(tipo) {
            const container = document.getElementById('tirePressureContainer');
            let tires = [];

            if (tipo === 'moto') {
                tires = ['Delantera', 'Trasera'];
            } else if (tipo === 'camion' || tipo === 'bus') {
                tires = ['Delantera Izq.', 'Delantera Der.', 'Trasera Izq. Ext.', 'Trasera Izq. Int.', 'Trasera Der. Int.', 'Trasera Der. Ext.'];
            } else {
                tires = ['Delantera Izquierda', 'Delantera Derecha', 'Trasera Izquierda', 'Trasera Derecha', 'Repuesto'];
            }

            container.innerHTML = tires.map((tire, index) => `
                <div class="tire-input">
                    <label>${tire}:</label>
                    <input type="number" id="tire${index}" step="0.1" placeholder="PSI" min="0">
                </div>
            `).join('');
        }

        function guardarRegistro() {
            if (!validarFormulario()) {
                alert('Por favor, complete todos los campos obligatorios marcados con *');
                return;
            }

            const registro = recopilarDatos();
            
            // Guardar en localStorage (o enviar a servidor)
            const registros = JSON.parse(localStorage.getItem('registros') || '[]');
            registros.push(registro);
            localStorage.setItem('registros', JSON.stringify(registros));

            alert('Registro guardado exitosamente');
        }

        function validarFormulario() {
            const placa = document.getElementById('placa').value;
            const tipoVehiculo = document.getElementById('tipoVehiculo').value;
            const nombreCliente = document.getElementById('nombreCliente').value;
            const cedulaCliente = document.getElementById('cedulaCliente').value;
            const fechaInspeccion = document.getElementById('fechaInspeccion').value;
            const inspector = document.getElementById('inspector').value;
            const frecuencia = document.querySelector('input[name="frecuencia"]:checked');
            const resultado = document.querySelector('input[name="resultado"]:checked');

            return placa && tipoVehiculo && nombreCliente && cedulaCliente && 
                   fechaInspeccion && inspector && frecuencia && resultado;
        }

        function recopilarDatos() {
            const data = {
                fecha: new Date().toISOString(),
                placa: document.getElementById('placa').value,
                tipoVehiculo: document.getElementById('tipoVehiculo').value,
                vehiculo: {
                    clase: document.getElementById('clase').value,
                    carroceria: document.getElementById('carroceria').value,
                    marca: document.getElementById('marca').value,
                    modelo: document.getElementById('modelo').value,
                    color: document.getElementById('color').value
                },
                cliente: {
                    nombre: document.getElementById('nombreCliente').value,
                    cedula: document.getElementById('cedulaCliente').value,
                    telefono: document.getElementById('telefono').value,
                    email: document.getElementById('email').value
                },
                inspeccion: {
                    fecha: document.getElementById('fechaInspeccion').value,
                    inspector: document.getElementById('inspector').value,
                    frecuencia: document.querySelector('input[name="frecuencia"]:checked').value,
                    resultado: document.querySelector('input[name="resultado"]:checked').value
                },
                checklist: [],
                presionNeumaticos: {},
                pruebas: [],
                observaciones: document.getElementById('observaciones').value,
                firmas: {
                    inspector: document.getElementById('firmaInspector').toDataURL(),
                    propietario: document.getElementById('firmaPropietario').toDataURL()
                }
            };

            // Recopilar checklist
            document.querySelectorAll('input[name="checklist"]:checked').forEach(cb => {
                data.checklist.push(cb.nextElementSibling.textContent);
            });

            // Recopilar presión de neumáticos
            document.querySelectorAll('#tirePressureContainer input').forEach(input => {
                if (input.value) {
                    data.presionNeumaticos[input.previousElementSibling.textContent] = input.value;
                }
            });

            // Recopilar pruebas (si aplica)
            document.querySelectorAll('input[name="pruebas"]:checked').forEach(cb => {
                data.pruebas.push(cb.nextElementSibling.textContent);
            });

            return data;
        }

        function exportarPDF() {
            if (!validarFormulario()) {
                alert('Por favor, complete todos los campos obligatorios antes de exportar');
                return;
            }

            // Ocultar botones antes de capturar
            const buttons = document.querySelectorAll('.btn, .signature-box button, .file-upload');
            buttons.forEach(btn => btn.style.display = 'none');

            const element = document.getElementById('printable-area');
            
            html2canvas(element, {
                scale: 2,
                useCORS: true,
                logging: false
            }).then(canvas => {
                const { jsPDF } = window.jspdf;
                
                // Tamaño oficio: 8.5 x 14 pulgadas = 215.9 x 355.6 mm
                const pdf = new jsPDF('p', 'mm', 'legal');
                
                const imgWidth = 215.9;
                const pageHeight = 355.6;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                const imgData = canvas.toDataURL('image/png');
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                const placa = document.getElementById('placa').value;
                const fecha = document.getElementById('fechaInspeccion').value;
                pdf.save(`Inspeccion_${placa}_${fecha}.pdf`);

                // Restaurar botones
                buttons.forEach(btn => btn.style.display = '');
            });
        }
    </script>
</body>
</html>
